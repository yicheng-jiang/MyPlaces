(function(){angular.module("myPlacesApp",["ngRoute","ngSanitize","ui.bootstrap"]);console.log("angular module defined");function e(e,t){console.log("routeProvider is called");e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});t.html5Mode({enabled:true,requireBase:false})}angular.module("myPlacesApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("myPlacesApp").controller("homeCtrl",e);e.$inject=["$scope","myplacesData","geolocation"];function e(t,a,e){console.log("homeCtrl controller called");var n=this;n.pageHeader={title:"MyPlaces",strapline:"Find places to work with wifi near you!"};n.sidebar={content:"Looking for wifi and a seat etc etc"};n.message="Checking your location";n.getData=function(e){var t=e.coords.latitude,o=e.coords.longitude;n.message="Searching for nearby places";a.locationByCoords(t,o).then(function(e){n.data={locations:e.data};n.message=e.data.length>0?"":"No locations found";console.log(n.data)},function(e){n.message="Sorry, something's gone wrong";console.log(e)})};n.showError=function(e){t.$apply(function(){n.message=e.message})};n.noGeo=function(){t.$apply(function(){n.message="Geolocation not supported by this browser."})};e.getPosition(n.getData,n.showError,n.noGeo)}})();(function(){angular.module("myPlacesApp").controller("aboutCtrl",e);function e(){var e=this;e.pageHeader={title:"About MyPlaces"};e.main={content:"MyPlaces was created to help people find places to sit down and get a bit of work done.\t\t\t\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim \t\t\taccumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. \t\t\tVestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper \t\t\ttellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, \t\t\taccumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper.\t\t\t\n\nSuspendisse tincidunt, lectus non suscipit pharetra, purus ipsum vehicula sapien, \t\t\ta volutpat mauris ligula vel dui. Proin varius interdum elit, eu porttitor \t\t\tquam consequat et. Quisque vitae felis sed ante fringilla fermentum in vitae \t\t\tsem. Quisque fermentum metus at neque sagittis imperdiet. Phasellus non laoreet \t\t\tmassa, eu laoreet nibh. Pellentesque vel magna vulputate, porta augue vel, \t\t\tdapibus nisl. Phasellus aliquet nibh nec nunc posuere fringilla. Quisque sit \t\t\tamet dignissim erat. Nulla facilisi. Donec in sollicitudin ante. Cras rhoncus \t\t\taccumsan rutrum. Sed aliquet ligula dui, eget laoreet turpis tempor vitae."}}})();(function(){angular.module("myPlacesApp").controller("locationDetailCtrl",e);e.$inject=["$routeParams","$uibModal","myplacesData"];function e(e,t,o){var a=this;a.locationid=e.locationid;console.log("locationDetailCtrl is called for: "+a.locationid);o.locationById(a.locationid).then(function(e){a.data={location:e.data,lblOpening:"Opening hours",lblFac:"Facilities",lblLoc:"Location map",lblAddReview:"Add review",reviewtitle:"Customer reviews",key:"AIzaSyDYw8KXmMJ_zuNYCJOP3vvdiFxbVUshoF4",sidebar:{context:"is on MyPlaces because it has accessible wifi and space to sit down with your laptop and get some work done.",callToAction:"If you've been and you like it - or if you don't - please leave a review to help other people just like you."}};a.pageHeader={title:a.data.location.name};a.popupReviewForm=function(){var e=t.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:a.locationid,locationName:a.data.location.name}}}});e.result.then(function(e){a.data.location.reviews.push(e)})};console.log("get data: "+JSON.stringify(a.data.location))},function(e){console.log(e)})}})();(function(){angular.module("myPlacesApp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","myplacesData","locationData"];function e(t,o,e){var a=this;a.locationData=e;a.modal={close:function(e){t.close(e)},cancel:function(){t.dismiss("cancel")}};a.onSubmit=function(){console.log(a.formData);a.formError="";if(!a.formData||!a.formData.name||!a.formData.rating||!a.formData.reviewText){a.formError="All fields required, please try again";return false}a.doAddReview(a.locationData.locationid,a.formData)};a.doAddReview=function(e,t){o.addReviewById(e,{author:t.name,rating:t.rating,reviewText:t.reviewText}).then(function(e){a.modal.close(e.data);console.log("Success!")},function(e){a.formError="You review has not been saved, try again"});return false}}})();(function(){var e=function(){console.log("geolocation service called");var e=function(e,t,o){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,t)}else{o()}};return{getPosition:e}};angular.module("myPlacesApp").service("geolocation",e)})();(function(){angular.module("myPlacesApp").service("myplacesData",e);e.$inject=["$http"];function e(o){console.log("myplacesData service called");var e=function(e,t){return o.get("/api/locations?lng="+t+"&lat="+e+"&maxDistance=20")};var t=function(e){return o.get("/api/locations/"+e)};var a=function(e,t){return o.post("/api/locations/"+e+"/reviews",t)};return{locationByCoords:e,locationById:t,addReviewById:a}}})();(function(){var a=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};var e=function(){return function(e){var t,o;console.log("formatDistance filter called");if(e===0||e&&a(e)){if(e>1){t=parseFloat(e).toFixed(1);o="km"}else{t=parseInt(e*1e3,10);o="m"}return t+o}else{return"?"}}};angular.module("myPlacesApp").filter("formatDistance",e)})();(function(){angular.module("myPlacesApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var t=e.replace(/\n/g,"<br />");console.log("addHtmlLineBreaks filter called: "+t);return t}}})();(function(){angular.module("myPlacesApp").directive("ratingStars",e);function e(){console.log("ratingStars filter loaded");return{scope:{thisRating:"=rating"},restrict:"EA",templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();(function(){angular.module("myPlacesApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("myPlacesApp").directive("navigation",e);function e(){return{retstrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html"}}})();(function(){angular.module("myPlacesApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();